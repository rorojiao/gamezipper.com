<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Word Puzzle</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:url('images/sand_texture.png') repeat,linear-gradient(135deg,#f4e4c1 0%,#e8d5a3 100%);color:#5d4e37;font-family:Georgia,'Times New Roman',serif;display:flex;flex-direction:column;align-items:center;min-height:100vh;overflow-x:hidden;transition:background 0.3s;position:relative}
body::after{content:'';position:fixed;inset:0;pointer-events:none;background:radial-gradient(ellipse at center,transparent 50%,rgba(139,115,85,0.3) 100%);z-index:0}
body.success-bg{background:linear-gradient(135deg,#d4edda,#c3e6cb)!important}
#header{text-align:center;padding:16px 0 8px;border-bottom:2px solid #8b7355;width:100%;max-width:500px;position:relative;z-index:1}
#header h1{font-size:32px;font-weight:700;letter-spacing:3px;color:#5d4e37;text-shadow:1px 1px 2px rgba(218,165,32,0.5);font-family:Georgia,'Times New Roman',serif}
#header .day{font-size:13px;color:#8b7355;margin-top:4px;font-style:italic}
#message{text-align:center;padding:8px;font-size:15px;min-height:28px;color:#5d4e37;position:relative;z-index:1;font-style:italic}
#grid{display:grid;grid-template-columns:repeat(5,62px);grid-template-rows:repeat(6,62px);gap:5px;margin:12px auto;perspective:1000px;position:relative;z-index:1}
.cell{width:62px;height:62px;border:2px solid #8b7355;background:url('images/tile_empty.png') center/cover no-repeat,#fdf5e6;display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:700;text-transform:uppercase;border-radius:4px;user-select:none;position:relative;transform-style:preserve-3d;transition:box-shadow 0.3s;font-family:Georgia,'Times New Roman',serif;color:#5d4e37}
.cell.filled{border-color:#6b5b45;animation:pop 0.1s cubic-bezier(0.175,0.885,0.32,1.275)}
.cell.pop-in{animation:popIn 100ms cubic-bezier(0.175,0.885,0.32,1.275)}
.cell.correct{background:url('images/tile_correct.png') center/cover no-repeat,#2d6a4f;border-color:#2d6a4f;color:#fff}
.cell.present{background:url('images/tile_present.png') center/cover no-repeat,#b8860b;border-color:#b8860b;color:#fff}
.cell.absent{background:#6c757d;border-color:#6c757d;color:#fff}
.cell.flip-anim{animation:flipInk 0.6s ease forwards}
.cell.win-bounce{animation:winBounce 0.5s cubic-bezier(0.175,0.885,0.32,1.275)}
.cell.hint-wiggle{animation:hintWiggle 0.5s ease}
@keyframes popIn{0%{transform:scale(1)}50%{transform:scale(1.15)}100%{transform:scale(1)}}
@keyframes pop{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}
@keyframes flipInk{
  0%{transform:rotateX(0deg)}
  50%{transform:rotateX(90deg)}
  51%{clip-path:circle(0% at center)}
  100%{transform:rotateX(0deg);clip-path:circle(100% at center)}
}
@keyframes shake{0%,100%{transform:translateX(0)}10%,50%,90%{transform:translateX(-8px)}30%,70%{transform:translateX(8px)}}
@keyframes winBounce{0%{transform:translateY(0)}40%{transform:translateY(-20px)}60%{transform:translateY(-5px)}80%{transform:translateY(-10px)}100%{transform:translateY(0)}}
@keyframes hintWiggle{0%,100%{transform:translateX(0)}25%{transform:translateX(-3px)}75%{transform:translateX(3px)}}
@keyframes celebText{0%{transform:scale(0);opacity:0}60%{transform:scale(1.2);opacity:1}100%{transform:scale(1);opacity:1}}
@keyframes scrollUnroll{0%{transform:translateY(-100%) scaleY(0);opacity:0}60%{transform:translateY(0) scaleY(1.05);opacity:1}100%{transform:translateY(0) scaleY(1);opacity:1}}
@keyframes featherFall{0%{transform:translateY(-20px) rotate(0deg);opacity:0}10%{opacity:0.3}90%{opacity:0.3}100%{transform:translateY(calc(100vh + 20px)) rotate(360deg);opacity:0}}
.shake{animation:shake 0.4s}
#keyboard{margin:12px auto;max-width:500px;width:100%;padding:0 8px;position:relative;z-index:1}
.kb-row{display:flex;justify-content:center;margin-bottom:6px;gap:4px}
.key{height:52px;min-width:32px;padding:0 8px;border:1px solid #8b7355;border-radius:8px;background:url('images/btn_key.png') center/100% 100% no-repeat,#f5f0e1;color:#5d4e37;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;text-transform:uppercase;flex:1;max-width:44px;user-select:none;transition:background 0.3s,transform 0.1s,box-shadow 0.1s;font-family:Georgia,'Times New Roman',serif;box-shadow:0 2px 0 #8b7355}
.key.wide{max-width:66px;font-size:12px}
.key.correct{background:url('images/btn_green.png') center/100% 100% no-repeat,#2d6a4f;color:#fff;border-color:#2d6a4f;box-shadow:0 2px 0 #1b4332}
.key.present{background:url('images/btn_yellow.png') center/100% 100% no-repeat,#b8860b;color:#fff;border-color:#b8860b;box-shadow:0 2px 0 #8b6508}
.key.absent{background:#6c757d;color:#fff;border-color:#6c757d;box-shadow:0 2px 0 #495057}
.key:hover{background:#ebe5d6;transform:translateY(-1px);box-shadow:0 3px 0 #8b7355}
.key:active{transform:translateY(2px);box-shadow:0 0 0 #8b7355}
#toast{position:fixed;top:80px;left:50%;transform:translateX(-50%);background:rgba(93,78,55,0.95);color:#fdf5e6;padding:12px 24px;border-radius:4px;font-size:14px;font-weight:700;display:none;z-index:99;border:1px solid #8b7355}
#share-btn{display:none;margin:8px auto;padding:12px 24px;background:#2d6a4f;color:#fff;border:1px solid #1b4332;border-radius:8px;font-size:16px;font-weight:700;cursor:pointer;position:relative;z-index:1;font-family:Georgia,serif}
#share-btn:active{opacity:0.8}
#particle-canvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9998}
#celeb-text{position:fixed;top:40%;left:50%;transform:translate(-50%,-50%) scale(0);font-size:48px;font-weight:900;color:#8b6508;text-shadow:0 0 20px rgba(218,165,32,0.5);z-index:9999;pointer-events:none;opacity:0;font-family:Georgia,serif}
#celeb-text.show{animation:celebText 0.6s cubic-bezier(0.175,0.885,0.32,1.275) forwards}
#scroll-banner{position:fixed;top:0;left:50%;transform:translateX(-50%);width:90%;max-width:400px;background:linear-gradient(180deg,#f4e4c1,#e8d5a3);border:2px solid #8b7355;border-top:none;border-radius:0 0 12px 12px;padding:20px;text-align:center;font-size:24px;font-weight:700;color:#5d4e37;z-index:10000;pointer-events:none;display:none;box-shadow:0 4px 20px rgba(0,0,0,0.3);font-family:Georgia,serif}
#scroll-banner.show{display:block;animation:scrollUnroll 0.8s ease-out forwards}
.feather{position:fixed;pointer-events:none;z-index:0;font-size:18px;opacity:0.3}
#red-flash{position:fixed;inset:0;border:4px solid transparent;pointer-events:none;z-index:9997;transition:border-color 0.1s}
#red-flash.flash{border-color:rgba(180,100,0,0.6)}
</style>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8346383990981353" crossorigin="anonymous"></script>
  <script src="../game-audio.js"></script>
</head>
<body>
<a href="https://gamezipper.com/" style="position:fixed;top:0;left:0;right:0;background:rgba(93,78,55,0.9);color:#f1c40f;text-align:center;padding:4px;font-size:12px;z-index:99999;text-decoration:none;font-family:Georgia,serif">‚¨Ö More Games at GameZipper.com</a>
<div id="scroll-banner"></div>
<div id="header"><h1>üìú Word Puzzle</h1><div class="day" id="dayNum"></div><button onclick="document.getElementById('tutorial-overlay').style.display='flex'" style="position:absolute;right:8px;top:12px;background:none;border:2px solid #8b7355;border-radius:50%;width:32px;height:32px;font-size:16px;color:#8b7355;cursor:pointer;font-weight:bold;font-family:Georgia,serif">?</button></div>
<div id="message"></div>
<div id="grid"></div>
<div style="display:flex;gap:12px;justify-content:center;margin:6px 0;font-size:11px;color:#8b7355;font-family:Georgia,serif;position:relative;z-index:1"><span>üíé Correct</span><span>üü° Wrong spot</span><span>ü™® Not in word</span></div>
<button id="hint-btn" onclick="useHint()" style="margin:6px auto;padding:10px 20px;background:linear-gradient(135deg,#b8860b,#daa520);color:#2a1f14;border:1px solid #8b6508;border-radius:8px;font-size:14px;font-weight:700;cursor:pointer;font-family:Georgia,serif;display:block;position:relative;z-index:1">üí° Hint (reveal a letter)</button>
<button id="share-btn" onclick="shareResult()">Share üìã</button>
<button id="play-again-btn" onclick="newPuzzle()" style="display:none;margin:8px auto;padding:12px 24px;background:#6a4c2d;color:#fff;border:1px solid #4a3320;border-radius:8px;font-size:16px;font-weight:700;cursor:pointer;font-family:Georgia,serif">New Puzzle üîÑ</button>
<div id="keyboard"></div>
<div id="toast"></div>
<canvas id="particle-canvas"></canvas>
<div id="celeb-text"></div>
<div id="red-flash"></div>
<script src="words.js"></script>
<script>
// Spawn dust particles
(function(){
  for(let i=0;i<6;i++){
    const d=document.createElement('div');
    d.className='dust';
    d.style.cssText=`left:${10+Math.random()*80}%;top:-10px;width:${1+Math.random()*2}px;height:${1+Math.random()*2}px;animation:dustFall ${8+Math.random()*12}s linear ${Math.random()*8}s infinite;opacity:${0.2+Math.random()*0.3}`;
    document.body.appendChild(d);
  }
})();

// WORDS and VALID_GUESSES loaded from words.js
const WL=5,MR=6;
let row=0,col=0,grid=[],answer="",gameOver=false;
let hintUsed=false; // One free hint per game

// === Particle System ===
const pCanvas=document.getElementById('particle-canvas');
const pCtx=pCanvas.getContext('2d');
let particles=[];
function resizePCanvas(){
  pCanvas.width=window.innerWidth*(window.devicePixelRatio||1);
  pCanvas.height=window.innerHeight*(window.devicePixelRatio||1);
  pCtx.setTransform(window.devicePixelRatio||1,0,0,window.devicePixelRatio||1,0,0);
}
resizePCanvas();
window.addEventListener('resize',resizePCanvas);

function spawnStoneChips(cx,cy,count){
  for(let i=0;i<count;i++){
    const angle=Math.random()*Math.PI*2;
    const speed=2+Math.random()*3;
    particles.push({type:'chip',x:cx,y:cy,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed-2,size:2+Math.random()*3,life:1,decay:0.03+Math.random()*0.02,color:['#8b7355','#6b5535','#a09070','#d4c5a0'][Math.floor(Math.random()*4)],rot:Math.random()*Math.PI*2,rotV:0.1+Math.random()*0.2});
  }
}

function spawnEmeraldParticles(cx,cy,count){
  for(let i=0;i<count;i++){
    const angle=Math.random()*Math.PI*2;
    const speed=1.5+Math.random()*3;
    particles.push({type:'gem',x:cx,y:cy,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed-1.5,size:3+Math.random()*4,life:1,decay:0.02+Math.random()*0.01,color:'#2ecc71',rot:Math.random()*Math.PI*2,rotV:0.1+Math.random()*0.15});
  }
}

function spawnGoldCoins(count){
  const colors=['#ffd700','#daa520','#f0c040','#2ecc71','#e74c3c','#3498db'];
  for(let i=0;i<count;i++){
    particles.push({
      type:'coin',
      x:Math.random()*window.innerWidth,
      y:-20-Math.random()*200,
      vx:(Math.random()-0.5)*2,
      vy:1.5+Math.random()*3,
      size:4+Math.random()*6,
      life:1,decay:0.003+Math.random()*0.003,
      color:colors[Math.floor(Math.random()*colors.length)],
      rot:Math.random()*Math.PI*2,
      rotV:0.05+Math.random()*0.1,
      gravity:0.04
    });
  }
}

function spawnStars(cx,cy,count){
  for(let i=0;i<count;i++){
    const angle=Math.random()*Math.PI*2;
    const speed=1.5+Math.random()*3;
    particles.push({type:'star',x:cx,y:cy,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed-1,size:3+Math.random()*4,life:1,decay:0.02+Math.random()*0.01,color:'#ffd700',rot:Math.random()*Math.PI*2,rotV:0.1+Math.random()*0.15});
  }
}

function drawStar(ctx,cx,cy,size,rot){
  ctx.save();ctx.translate(cx,cy);ctx.rotate(rot);
  ctx.beginPath();
  for(let i=0;i<5;i++){
    const a=(i*4*Math.PI/5)-Math.PI/2;
    ctx[i===0?'moveTo':'lineTo'](Math.cos(a)*size,Math.sin(a)*size);
    const a2=a+2*Math.PI/5;
    ctx.lineTo(Math.cos(a2)*size*0.4,Math.sin(a2)*size*0.4);
  }
  ctx.closePath();ctx.fill();ctx.restore();
}

function drawDiamond(ctx,cx,cy,size,rot){
  ctx.save();ctx.translate(cx,cy);ctx.rotate(rot);
  ctx.beginPath();
  ctx.moveTo(0,-size);ctx.lineTo(size*0.6,0);ctx.lineTo(0,size);ctx.lineTo(-size*0.6,0);
  ctx.closePath();ctx.fill();ctx.restore();
}

function animateParticles(){
  pCtx.clearRect(0,0,window.innerWidth,window.innerHeight);
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.life-=p.decay;
    if(p.life<=0){particles.splice(i,1);continue;}
    p.x+=p.vx;p.y+=p.vy;
    if(p.gravity)p.vy+=p.gravity;
    else p.vy+=0.08;
    p.rot+=p.rotV||0;
    pCtx.globalAlpha=p.life;
    pCtx.fillStyle=p.color;
    if(p.type==='chip'){
      pCtx.save();pCtx.translate(p.x,p.y);pCtx.rotate(p.rot);
      pCtx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.7);
      pCtx.restore();
    }else if(p.type==='gem'){
      pCtx.shadowColor=p.color;pCtx.shadowBlur=8;
      drawDiamond(pCtx,p.x,p.y,p.size*p.life,p.rot);
      pCtx.shadowBlur=0;
    }else if(p.type==='star'){
      pCtx.shadowColor=p.color;pCtx.shadowBlur=6;
      drawStar(pCtx,p.x,p.y,p.size*p.life,p.rot);
      pCtx.shadowBlur=0;
    }else if(p.type==='coin'){
      pCtx.shadowColor='#ffd700';pCtx.shadowBlur=4;
      pCtx.save();pCtx.translate(p.x,p.y);pCtx.rotate(p.rot);
      pCtx.beginPath();pCtx.arc(0,0,p.size,0,Math.PI*2);pCtx.fill();
      pCtx.strokeStyle='rgba(0,0,0,0.3)';pCtx.lineWidth=1;pCtx.stroke();
      pCtx.restore();
      pCtx.shadowBlur=0;
    }
  }
  pCtx.globalAlpha=1;
  requestAnimationFrame(animateParticles);
}
animateParticles();

// Web Audio
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function playFlipSound(i){
  if(audioCtx.state==='suspended')audioCtx.resume();
  const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.type='sine';
  o.frequency.setValueAtTime(250+i*60,audioCtx.currentTime);
  g.gain.setValueAtTime(0.08,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.2);
  o.connect(g);g.connect(audioCtx.destination);
  o.start();o.stop(audioCtx.currentTime+0.2);
}
function playCorrectSound(){
  if(audioCtx.state==='suspended')audioCtx.resume();
  const notes=[440,554,659,880];
  notes.forEach((f,i)=>{
    const o=audioCtx.createOscillator(),g=audioCtx.createGain();
    o.type='sine';o.frequency.setValueAtTime(f,audioCtx.currentTime+i*0.12);
    g.gain.setValueAtTime(0.12,audioCtx.currentTime+i*0.12);
    g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+i*0.12+0.3);
    o.connect(g);g.connect(audioCtx.destination);
    o.start(audioCtx.currentTime+i*0.12);o.stop(audioCtx.currentTime+i*0.12+0.3);
  });
}

function dayIndex(){const d=new Date(),e=new Date(2025,0,1);return Math.floor((d-e)/864e5)}
function init(){
  const di=dayIndex();
  answer=WORDS[di%WORDS.length];
  document.getElementById("dayNum").textContent="Ancient Scroll #"+di;
  const g=document.getElementById("grid");
  for(let r=0;r<MR;r++){grid[r]=[];for(let c=0;c<WL;c++){const d=document.createElement("div");d.className="cell";d.id="c"+r+"_"+c;d.textContent="";g.appendChild(d);grid[r][c]=""}}
  buildKeyboard();
  document.addEventListener("keydown",onKey);
  loadState();
}
function buildKeyboard(){
  const rows=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["ENTER","Z","X","C","V","B","N","M","‚å´"]];
  const kb=document.getElementById("keyboard");
  rows.forEach(r=>{const d=document.createElement("div");d.className="kb-row";r.forEach(k=>{const b=document.createElement("button");b.className="key"+(k.length>1?" wide":"");b.textContent=k;b.id="k_"+k;b.onclick=()=>handleKey(k);d.appendChild(b)});kb.appendChild(d)})
}
function isHintCell(r,c){
  // A hint cell has green background set by useHint (pre-filled, don't overwrite)
  var el=document.getElementById("c"+r+"_"+c);
  return el&&el.style.background&&el.style.background.includes('2d6a4f');
}
function nextEmptyCol(){
  var c=col;while(c<WL&&grid[row][c])c++;return c;
}
function handleKey(k){
  if(gameOver)return;
  if(audioCtx.state==='suspended')audioCtx.resume();
  if(k==="‚å´"||k==="BACKSPACE"){
    // Skip backward over hint cells
    var nc=col-1;
    while(nc>=0&&isHintCell(row,nc))nc--;
    if(nc>=0){col=nc;grid[row][col]="";updateCell(row,col,"");}
  }
  else if(k==="ENTER"){submitGuess()}
  else if(k.length===1&&/^[A-Z]$/i.test(k)){
    // Skip forward over hint cells
    while(col<WL&&isHintCell(row,col))col++;
    if(col>=WL)return;
    grid[row][col]=k.toUpperCase();
    updateCell(row,col,k.toUpperCase());
    const el=document.getElementById("c"+row+"_"+col);
    el.classList.remove('pop-in');
    void el.offsetWidth;
    el.classList.add('pop-in');
    col++;
    // Skip over any hint cells
    while(col<WL&&isHintCell(row,col))col++;
    if(col>=WL&&grid[row].every(c=>c)){
      setTimeout(()=>{
        for(let c=0;c<WL;c++){
          const cel=document.getElementById("c"+row+"_"+c);
          cel.classList.add('hint-wiggle');
          setTimeout(()=>cel.classList.remove('hint-wiggle'),500);
        }
      },150);
    }
  }
}
function onKey(e){
  if(e.ctrlKey||e.metaKey||e.altKey)return;
  const k=e.key.toUpperCase();
  if(k==="BACKSPACE")handleKey("‚å´");
  else if(k==="ENTER")handleKey("ENTER");
  else if(k.length===1&&/^[A-Z]$/.test(k))handleKey(k);
}
function updateCell(r,c,v){const el=document.getElementById("c"+r+"_"+c);el.textContent=v;el.className=v?"cell filled":"cell"}
function submitGuess(){
  // Check all cells filled (including hint cells)
  if(!grid[row].every(c=>c)){shakeRow();return}
  const guess=grid[row].join("");
  if(!VALID_GUESSES.has(guess)){
    toast("Not in word list");
    shakeRow();
    const rf=document.getElementById('red-flash');
    rf.classList.add('flash');
    setTimeout(()=>rf.classList.remove('flash'),300);
    return;
  }
  revealRow(row,guess);
}
function revealRow(r,guess){
  const ans=[...answer],g=[...guess],res=Array(WL).fill("absent");
  for(let i=0;i<WL;i++)if(g[i]===ans[i]){res[i]="correct";ans[i]="#";g[i]="*"}
  for(let i=0;i<WL;i++)if(g[i]!=="*"){const j=ans.indexOf(g[i]);if(j>=0){res[i]="present";ans[j]="#"}}
  
  for(let i=0;i<WL;i++){
    const el=document.getElementById("c"+r+"_"+i);
    const cls=res[i];
    const letter=grid[r][i];
    setTimeout(()=>{
      playFlipSound(i);
      el.classList.add("flip-anim");
      // Stone chips when flipping
      const rect=el.getBoundingClientRect();
      spawnStoneChips(rect.left+rect.width/2,rect.top+rect.height/2,5);
      setTimeout(()=>{
        el.classList.add(cls);
        colorKey(letter,cls);
        if(cls==='correct'){
          el.classList.add('correct-flash');
          setTimeout(()=>el.classList.remove('correct-flash'),500);
          spawnEmeraldParticles(rect.left+rect.width/2,rect.top+rect.height/2,8);
        }
      },300);
    },i*100);
  }
  setTimeout(()=>{
    if(guess===answer){
      gameOver=true;
      const msgs=["BRILLIANT!","MAGNIFICENT!","IMPRESSIVE!","SPLENDID!","GREAT!","PHEW!"];
      msg(msgs[r]);
      playCorrectSound();
      
      // 1. Gold light pillars from each cell
      for(let c=0;c<WL;c++){
        const cel=document.getElementById("c"+r+"_"+c);
        setTimeout(()=>{
          cel.classList.add('win-bounce');
          setTimeout(()=>cel.classList.remove('win-bounce'),500);
          const rect=cel.getBoundingClientRect();
          spawnStars(rect.left+rect.width/2,rect.top,5);
        },c*100);
      }
      // 2. Gold coins + gems
      setTimeout(()=>spawnGoldCoins(50),300);
      // 3. BRILLIANT! text
      const ct=document.getElementById('celeb-text');
      ct.textContent=msgs[r];
      ct.className='show';
      setTimeout(()=>{ct.className='';ct.style.opacity='0';},2500);
      // 4. Gold background flash
      document.body.classList.add('gold-flash');
      setTimeout(()=>document.body.classList.remove('gold-flash'),800);
      document.body.classList.add('success-bg');
      setTimeout(()=>document.body.classList.remove('success-bg'),2000);
      // 5. Golden scroll banner from top
      const sb=document.getElementById('scroll-banner');
      sb.textContent='‚ú® '+msgs[r]+' ‚ú®';
      sb.classList.add('show');
      setTimeout(()=>{sb.classList.remove('show');sb.style.display='none';},3000);
      
      showEnd();
    }
    else if(r===MR-1){gameOver=true;msg("The word was: "+answer);showEnd()}
    else{row++;col=0}
    saveState();
  },WL*100+400);
}
function colorKey(letter,cls){
  const el=document.getElementById("k_"+letter);if(!el)return;
  const rank={correct:3,present:2,absent:1};
  const cur=el.classList.contains("correct")?3:el.classList.contains("present")?2:el.classList.contains("absent")?1:0;
  if(rank[cls]>cur){el.className="key"+(letter.length>1?" wide":"");el.classList.add(cls)}
}
function shakeRow(){for(let c=0;c<WL;c++){const el=document.getElementById("c"+row+"_"+c);el.classList.add("shake");setTimeout(()=>el.classList.remove("shake"),400)}}
function msg(t){document.getElementById("message").textContent=t}
function toast(t){const el=document.getElementById("toast");el.textContent=t;el.style.display="block";setTimeout(()=>el.style.display="none",1500)}
function showEnd(){document.getElementById("share-btn").style.display="block";document.getElementById("play-again-btn").style.display="block";document.getElementById("hint-btn").style.display="none"}
function useHint(){
  if(gameOver||hintUsed)return;
  hintUsed=true;
  document.getElementById('hint-btn').style.display='none';
  // Find an unrevealed position (not yet guessed correctly in any row)
  var revealed=new Set();
  for(var r=0;r<row;r++){
    for(var c=0;c<WL;c++){
      if(grid[r][c]===answer[c]) revealed.add(c);
    }
  }
  // Also check current row for already-placed correct letters
  for(var c=0;c<col;c++){
    if(grid[row][c]===answer[c]) revealed.add(c);
  }
  // Pick a random unrevealed position
  var unrevealed=[];
  for(var i=0;i<WL;i++){if(!revealed.has(i))unrevealed.push(i);}
  if(!unrevealed.length){toast("All letters known!");return;}
  var hintPos=unrevealed[Math.floor(Math.random()*unrevealed.length)];
  // Place the hint letter in current row
  // Clear current row first, place hint at correct position
  for(var c=col;c<WL;c++){grid[row][c]="";updateCell(row,c,"");}
  grid[row][hintPos]=answer[hintPos];
  updateCell(row,hintPos,answer[hintPos]);
  var el=document.getElementById("c"+row+"_"+hintPos);
  el.style.background="#2d6a4f";el.style.color="#fff";el.style.borderColor="#2d6a4f";
  toast("üí° "+answer[hintPos]+" is at position "+(hintPos+1)+"!");
  // Adjust col to first empty position
  col=0;while(col<WL&&grid[row][col])col++;
}
function newPuzzle(){
  // Reset state for a random practice puzzle
  gameOver=false;row=0;col=0;hintUsed=false;
  document.getElementById('hint-btn').style.display='block';
  grid=[];for(var i=0;i<MR;i++){grid[i]=[];for(var j=0;j<WL;j++)grid[i][j]="";}
  // Pick a random word (not today's)
  var idx=Math.floor(Math.random()*WORDS.length);
  answer=WORDS[idx].toUpperCase();
  document.getElementById("share-btn").style.display="none";
  document.getElementById("play-again-btn").style.display="none";
  document.getElementById("message").textContent="";
  document.getElementById("dayNum").textContent="Practice Mode";
  // Reset grid display
  var gridEl=document.getElementById("grid");
  gridEl.innerHTML="";
  for(var r=0;r<MR;r++){var rowDiv=document.createElement("div");rowDiv.className="row";for(var c=0;c<WL;c++){var cell=document.createElement("div");cell.className="cell";cell.id="c"+r+"_"+c;rowDiv.appendChild(cell);}gridEl.appendChild(rowDiv);}
  // Reset keyboard colors
  document.querySelectorAll("#keyboard button").forEach(function(b){b.className="key";});
  // Clear saved state
  localStorage.removeItem("wp_"+dayIndex());
}
function shareResult(){
  const map={correct:"üü©",present:"üü®",absent:"‚¨õ"};
  let t="Ancient Cipher #"+dayIndex()+" "+(gameOver&&grid[row]?.join("")===answer?(row+1)+"/6":"X/6")+"\n\n";
  const maxR=gameOver&&grid[row]?.join("")===answer?row+1:gameOver?MR:row;
  for(let r=0;r<maxR;r++){
    const ans=[...answer],g=[...grid[r]],res=Array(WL).fill("absent");
    for(let i=0;i<WL;i++)if(g[i]===ans[i]){res[i]="correct";ans[i]="#";g[i]="*"}
    for(let i=0;i<WL;i++)if(g[i]!=="*"){const j=ans.indexOf(g[i]);if(j>=0){res[i]="present";ans[j]="#"}}
    t+=res.map(r=>map[r]).join("")+"\n";
  }
  if(navigator.clipboard)navigator.clipboard.writeText(t).then(()=>toast("Copied to clipboard!"));
  else toast("Share:\n"+t);
}
function saveState(){try{localStorage.setItem("wp_"+dayIndex(),JSON.stringify({row,col,grid,gameOver}))}catch(e){}}
function loadState(){try{const s=JSON.parse(localStorage.getItem("wp_"+dayIndex()));if(!s)return;
  for(let r=0;r<s.row||(s.gameOver&&r<=s.row);r++){if(!s.grid[r])break;for(let c=0;c<WL;c++){if(!s.grid[r][c])continue;grid[r][c]=s.grid[r][c];const el=document.getElementById("c"+r+"_"+c);el.textContent=s.grid[r][c];
    const ans=[...answer],g=[...s.grid[r]],res=Array(WL).fill("absent");
    for(let i=0;i<WL;i++)if(g[i]===ans[i]){res[i]="correct";ans[i]="#";g[i]="*"}
    for(let i=0;i<WL;i++)if(g[i]!=="*"){const j=ans.indexOf(g[i]);if(j>=0){res[i]="present";ans[j]="#"}}
    el.className="cell "+res[c];colorKey(s.grid[r][c],res[c])}}
  row=s.row;col=s.col;gameOver=s.gameOver;
  if(gameOver){document.getElementById("share-btn").style.display="block";if(s.grid[row-1]?.join("")===answer)msg(["BRILLIANT!","MAGNIFICENT!","IMPRESSIVE!","SPLENDID!","GREAT!","PHEW!"][row-1]);else msg("The word was: "+answer)}
}catch(e){}}
init();
// Floating feather/page particles
(function(){
  const symbols=['ü™∂','üìÑ','üçÇ','‚úíÔ∏è','üìú'];
  for(let i=0;i<5;i++){
    const f=document.createElement('div');
    f.className='feather';
    f.textContent=symbols[i%symbols.length];
    f.style.left=Math.random()*100+'%';
    f.style.fontSize=(14+Math.random()*10)+'px';
    f.style.animation='featherFall '+(25+Math.random()*20)+'s linear '+(Math.random()*20)+'s infinite';
    document.body.appendChild(f);
  }
})();
window._gameState={get answer(){return answer},get row(){return row},get col(){return col},get grid(){return grid},get gameOver(){return gameOver},newPuzzle:newPuzzle};
</script>

<!-- Tutorial Overlay -->
<div id="tutorial-overlay" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(20,15,8,0.85);z-index:99999;display:flex;align-items:center;justify-content:center;font-family:Georgia,serif;overflow-y:auto">
  <div style="background:linear-gradient(145deg,#3a2f20,#2a1f14);border:2px solid #5a4a2a;border-radius:16px;padding:28px 22px 22px;max-width:360px;width:92%;color:#d4c5a0;text-align:center;box-shadow:0 8px 32px rgba(0,0,0,0.6);margin:20px auto;">
    <div style="font-size:26px;font-weight:bold;margin-bottom:14px;color:#d4a547">üìú How to Play</div>
    <div style="font-size:14px;line-height:1.6;text-align:left;margin-bottom:16px;">Guess the hidden <b>5-letter word</b> in <b>6 tries</b>.<br>After each guess, tiles change color to show how close you are.</div>
    <div style="margin-bottom:16px;">
      <div style="font-size:13px;font-weight:bold;color:#d4a547;text-align:left;margin-bottom:8px;">Examples:</div>
      <div style="display:flex;gap:4px;margin-bottom:8px;">
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;background:#2d6a4f;color:#fff;border:2px solid #2d6a4f">W</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">E</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">A</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">R</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">Y</span>
      </div>
      <div style="font-size:13px;text-align:left;margin-bottom:10px;"><b style="color:#2ecc71">W</b> is in the word and in the <b style="color:#2ecc71">correct spot</b>. üíé</div>
      <div style="display:flex;gap:4px;margin-bottom:8px;">
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">P</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;background:#b8860b;color:#fff;border:2px solid #b8860b">I</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">L</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">L</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">S</span>
      </div>
      <div style="font-size:13px;text-align:left;margin-bottom:10px;"><b style="color:#daa520">I</b> is in the word but in the <b style="color:#daa520">wrong spot</b>. üü°</div>
      <div style="display:flex;gap:4px;margin-bottom:8px;">
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">V</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">A</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">G</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;background:#6c757d;color:#fff;border:2px solid #6c757d">U</span>
        <span style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:bold;border-radius:4px;border:2px solid #8b7355;color:#d4c5a0">E</span>
      </div>
      <div style="font-size:13px;text-align:left;"><b style="color:#999">U</b> is <b style="color:#999">not in the word</b> at all. ü™®</div>
    </div>
    <div style="font-size:12px;color:#8b7355;margin-bottom:14px;border-top:1px solid #5a4a2a;padding-top:10px;">A new word every day! Use the keyboard below or type on your physical keyboard.</div>
    <button onmousedown="var o=document.getElementById('tutorial-overlay');if(o)o.style.display='none';localStorage.setItem('word-puzzle-tutorial-seen','1');" style="touch-action:manipulation;cursor:pointer;position:relative;z-index:10000000;background:linear-gradient(135deg,#8b6d3e,#d4a547);color:#2a1f14;border:none;border-radius:12px;padding:14px 36px;font-size:18px;font-weight:bold;box-shadow:0 4px 15px rgba(139,109,62,0.4);user-select:none;-webkit-user-select:none;">Let's Play! üìú</button>
  </div>
</div>
<script>if(!localStorage.getItem('word-puzzle-tutorial-seen')){document.getElementById('tutorial-overlay').style.display='flex';}else{document.getElementById('tutorial-overlay').style.display='none';}</script>

<script>
(function(){
  var ov = document.getElementById('tutorial-overlay');
  if (!ov) return;
  // Show tutorial only if not seen before
  if (!localStorage.getItem('word-puzzle-tutorial-seen')) {
    ov.style.display = 'flex';
  }
})();
</script>
  <script src="../game-audio-auto.js"></script>
<script src="../sound-toggle.js"></script>
</body>
</html>
